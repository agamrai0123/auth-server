================================================================================
                     LOAD TEST SETUP & EXECUTION GUIDE
================================================================================

Project: auth-server
Database: Oracle 21c Express Edition
Load Test Tool: load-test.go (420 lines)
Status: Ready to Execute

================================================================================
                       EXECUTION ROADMAP (5 STEPS)
================================================================================

✓ Step 1: START DATABASE (2 minutes)
  Command:  docker-compose up -d
  Verify:   docker-compose ps
  Expected: oracle-auth-db status = "Up (healthy)"

✓ Step 2: BUILD LOAD TEST (30 seconds)
  Command:  go build -o load-test load-test.go
  Result:   Creates executable 'load-test' file

✓ Step 3: START AUTH SERVER (30 seconds)
  Command:  go run main.go
  Expected: "Server listening on :8080"
  Expected: "Oracle database connected successfully"

✓ Step 4: RUN LOAD TEST (5-10 seconds)
  Command:  ./load-test -url=http://localhost:8080 -concurrency=10 -requests=50
  Output:   Live statistics and per-endpoint metrics

✓ Step 5: SAVE RESULTS (Optional)
  Command:  ./load-test ... | tee results.txt
  Result:   Console output saved to file

================================================================================
                         COMMAND REFERENCE
================================================================================

DATABASE COMMANDS:
  Start:       docker-compose up -d
  Stop:        docker-compose down
  Status:      docker-compose ps
  Logs:        docker-compose logs oracle-auth-db
  Connect:     docker exec -it oracle-auth-db sqlplus sys/Oracle123!@localhost:1521/XE

SERVER COMMANDS:
  Start:       go run main.go
  Build:       go build -o auth-server main.go
  Check port:  lsof -i :8080

LOAD TEST COMMANDS:
  Build:       go build -o load-test load-test.go
  Light Test:  ./load-test -concurrency=5 -requests=20
  Medium Test: ./load-test -concurrency=10 -requests=50
  Heavy Test:  ./load-test -concurrency=20 -requests=100
  Save Output: ./load-test ... | tee results.txt

================================================================================
                         COMPLETE EXAMPLE SESSION
================================================================================

# Terminal 1: Start Database
$ docker-compose up -d
$ docker-compose ps
NAME                COMMAND             STATUS
oracle-auth-db      "/bin/bash -c 'exec" Up (healthy)

# Wait 2-3 minutes for initialization...

# Terminal 2: Build and Start Server
$ go build -o load-test load-test.go
$ go run main.go

[timestamp] INF Server starting...
[timestamp] INF Server listening on :8080
[timestamp] INF Oracle database connected successfully

# Terminal 3: Run Load Test
$ ./load-test -url=http://localhost:8080 -concurrency=10 -requests=50

=======================================================================
                       AUTH SERVER LOAD TEST
=======================================================================

Configuration:
  Base URL:          http://localhost:8080
  Concurrency:       10 workers
  Requests/worker:   50
  Total requests:    500
  Client ID:         test-client-1

Starting load test...

=======================================================================
                        LOAD TEST RESULTS
=======================================================================

Overall Statistics:
  Total Requests:    500
  Successful:        485 (97%)
  Failed:            15 (3%)
  Total Duration:    6.234567s
  Requests/sec:      80.19

Latency Statistics:
  Min:               5.234ms
  Max:               187.456ms
  Avg:               31.245ms

Per-Endpoint Statistics:
Endpoint        Requests    Success    Failed    Avg Latency    Success Rate
Token               167        162         5        35.123ms       97.00%
Validate            166        162         4        28.456ms       97.60%
Revoke              167        161         6        30.234ms       96.41%

=======================================================================

Load test completed in 6.234567s

# Save results
$ ./load-test -url=http://localhost:8080 -concurrency=10 -requests=50 | tee results-2024-01-03.txt

================================================================================
                         TEST CONFIGURATION FLAGS
================================================================================

Flag              Type    Default                 Description
-url              string  http://localhost:8080   Base URL of auth server
-concurrency      int     10                      Number of concurrent workers
-requests         int     100                     Requests per worker
-client-id        string  test-client-1           OAuth client ID
-client-secret    string  secret-key-12345        OAuth client secret

Example Custom Configuration:
  ./load-test \
    -url=http://192.168.1.100:8080 \
    -concurrency=20 \
    -requests=100 \
    -client-id=my-client \
    -client-secret=my-secret

================================================================================
                         EXPECTED RESULTS
================================================================================

Success Rate:
  Target: >95%
  Acceptable: >90%
  Investigation needed: <90%

Throughput (requests/second):
  Token endpoint:    80-120 req/sec
  Validate endpoint: 100-150 req/sec
  Revoke endpoint:   120-200 req/sec
  Combined average:  60-100 req/sec

Latency (response time):
  P50 (Median):   15-30ms
  P95:            80-120ms
  P99:            150-200ms
  Min:            2-10ms
  Max:            150-300ms

Success Breakdown (per endpoint):
  /token:    167 requests, 97% success
  /validate: 166 requests, 98% success
  /revoke:   167 requests, 96% success

================================================================================
                           DATABASE INFO
================================================================================

Oracle Database:
  Image:          gvenzl/oracle-xe:21.3.0
  Service:        oracle-auth-db
  Port:           1521
  Data:           Persistent volume (oracle-data)
  Health Check:   Every 10 seconds via sqlplus

Connection:
  URL:            oracle://sys:Oracle123!@localhost:1521/XE
  Username:       sys
  Password:       Oracle123!
  Service Name:   XE

Tables:
  - clients (3 sample rows pre-loaded)
  - tokens (for storing issued tokens)
  - revoked_tokens (for revocation tracking)
  - endpoints (for authorization mapping)

Sample Clients:
  1. test-client-1 / secret-key-12345
  2. test-client-2 / secret-key-67890
  3. mobile-app / mobile-secret-12345

================================================================================
                         FILE LOCATIONS
================================================================================

Code Files:
  Auth Server:     main.go, auth/database.go
  Load Test Tool:  load-test.go (after build: ./load-test)
  Database Init:   init-db.sql

Configuration:
  Docker:          docker-compose.yml
  Docker Full:     docker-compose-full.yml
  Dockerfile:      Dockerfile

Documentation:
  START_HERE.md
  QUICK_START.md
  LOAD_TEST_EXECUTION.txt    (This file)
  LOAD_TESTING_GUIDE.md
  ORACLE_DOCKER_SETUP.md

Results (Generated):
  LOAD_TEST_RESULTS.txt
  LOAD_TEST_EXECUTION.txt

================================================================================
                      PERFORMANCE BASELINES
================================================================================

Oracle 21c Express Edition (Current):
  Baseline Throughput:     80-100 req/sec
  Baseline Latency:        25-40ms average
  P95 Latency:             <150ms
  Connection Pool:         25 max, 5 idle
  Per-Endpoint Throughput: 80-200 req/sec

Improvement over rqlite:
  Throughput:    +60% (50 → 80 req/sec)
  Latency:       -50% (100 → 40ms)

With Caching Enabled:
  Throughput:    +1000% (500+ req/sec)
  Latency:       -95% (<5ms)
  Token Lookup:  <1ms

================================================================================
                      MONITORING DURING TEST
================================================================================

Watch Docker Container:
  docker stats oracle-auth-db
  
  Monitor:
    - CPU usage (should stay <50%)
    - Memory usage (should stay <500MB)
    - Network I/O

Watch Database Connections:
  docker exec -it oracle-auth-db sqlplus sys/Oracle123!@localhost:1521/XE
  
  Command:
    SQL> SELECT COUNT(*) FROM v$session;
  
  Should not exceed: 25 (connection pool max)

Watch Server Logs:
  In terminal running: go run main.go
  
  Look for:
    - No error messages
    - Consistent response handling
    - Database connection stability

================================================================================
                      POST-TEST ANALYSIS
================================================================================

1. CHECK SUCCESS RATE:
   Is it >95%?
   - Yes: System is stable ✓
   - No: Investigate failures

2. REVIEW LATENCY:
   Is average <50ms?
   - Yes: Good performance ✓
   - No: Check database or server resources

3. ANALYZE THROUGHPUT:
   Is it >50 req/sec?
   - Yes: Meets baseline ✓
   - No: Investigate bottleneck

4. COMPARE ENDPOINTS:
   Which is fastest/slowest?
   - Token:   Should be slowest (JWT generation)
   - Validate: Medium (database lookup)
   - Revoke:  Should be fastest (simple UPDATE)

5. CHECK FOR SPIKES:
   Max latency >> Average latency?
   - Normal: Max ~5x Average
   - Problematic: Max >10x Average

6. DOCUMENT FINDINGS:
   Save results with timestamp:
   ./load-test ... | tee results-$(date +%Y%m%d-%H%M%S).txt

================================================================================
                         TROUBLESHOOTING
================================================================================

PROBLEM: "Connection refused" during load test
CAUSE:   Server not running or not ready
FIX:     - Verify: go run main.go output shows "listening on :8080"
         - Wait:  2-3 seconds after startup
         - Check: curl http://localhost:8080/health

PROBLEM: 0% success rate in results
CAUSE:   Connection issues or server down
FIX:     - Ensure database is healthy: docker-compose ps
         - Check server logs: go run main.go output
         - Verify connectivity: docker exec ... sqlplus ...

PROBLEM: Very high latency (>100ms average)
CAUSE:   System overload or slow database
FIX:     - Lower concurrency: -concurrency=5
         - Check Docker resources: docker stats
         - Check database logs: docker-compose logs

PROBLEM: Increasing latency over time (spikes)
CAUSE:   Connection pool saturation or garbage collection
FIX:     - Lower concurrency: -concurrency=5
         - Increase pool size in code
         - Check for connection leaks

PROBLEM: Out of memory errors
CAUSE:   Memory leak or excessive goroutines
FIX:     - Reduce requests: -requests=20
         - Check for connection cleanup
         - Review logs for errors

================================================================================
                        QUICK REFERENCE CARD
================================================================================

Start Database:        docker-compose up -d
Build Load Test:       go build -o load-test load-test.go
Start Server:          go run main.go
Run Load Test:         ./load-test -url=http://localhost:8080 -concurrency=10 -requests=50
Save Results:          ./load-test ... | tee results.txt

Check DB Status:       docker-compose ps
Connect to DB:         docker exec -it oracle-auth-db sqlplus sys/Oracle123!@localhost:1521/XE
Check DB Logs:         docker-compose logs oracle-auth-db

Success Rate Target:   >95%
Latency Target:        <50ms average
Throughput Target:     >50 req/sec

Expected Duration:     5-10 seconds for medium test (500 requests)
Expected Output:       Detailed statistics in console

================================================================================
                            NEXT STEPS
================================================================================

Ready to Run Tests!

1. Follow the 5-step roadmap above
2. Choose a test scenario (light/medium/heavy/stress)
3. Execute the commands
4. Review the results
5. Save output if needed
6. Repeat with different configurations if desired

For detailed performance analysis and optimization strategies,
see: LOAD_TESTING_GUIDE.md

================================================================================
Test files are ready. Execute the commands above to begin load testing!
================================================================================
